{% extends "base.html" %}

{% block title %}Edit Email Account - MailMind AI{% endblock %}

{% block page_title %}Edit Email Account{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('list_accounts') }}">Email Accounts</a></li>
<li class="breadcrumb-item active">Edit</li>
{% endblock %}

{% block content %}
<section class="section">
  <div class="row">
    <div class="col-lg-8">

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Edit Email Account</h5>

          <!-- Multi Columns Form -->
          <form class="row g-3" method="POST" action="{{ url_for('edit_account', id=account.id) }}">
            <div class="col-md-12">
              <label for="email_address" class="form-label">Email Address</label>
              <input type="email" class="form-control" id="email_address" name="email_address" value="{{ account.email_address }}" required>
            </div>
            <div class="col-md-8">
              <label for="host" class="form-label">Host</label>
              <input type="text" class="form-control" id="host" name="host" value="{{ account.host }}" required placeholder="imap.example.com">
            </div>
            <div class="col-md-4">
              <label for="port" class="form-label">Port</label>
              <input type="number" class="form-control" id="port" name="port" value="{{ account.port }}" required min="1" max="65535">
            </div>
            <div class="col-md-12">
              <label for="username" class="form-label">Username</label>
              <input type="text" class="form-control" id="username" name="username" value="{{ account.username }}" required>
            </div>
            <div class="col-md-12">
              <label for="password" class="form-label">Password</label>
              <input type="password" class="form-control" id="password" name="password" placeholder="Leave blank to keep current password">
              <div class="form-text">Current password is masked. Leave blank to keep unchanged.</div>
            </div>
            <div class="col-md-12">
              <label class="form-label">Encryption</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="encryption" id="encryption_ssl" value="ssl" {% if account.use_ssl %}checked{% endif %}>
                <label class="form-check-label" for="encryption_ssl">
                  SSL (Port 993)
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="encryption" id="encryption_tls" value="tls" {% if account.use_tls %}checked{% endif %}>
                <label class="form-check-label" for="encryption_tls">
                  TLS/STARTTLS (Port 143)
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="encryption" id="encryption_none" value="none" {% if not account.use_ssl and not account.use_tls %}checked{% endif %}>
                <label class="form-check-label" for="encryption_none">
                  Unverschl√ºsselt (Port 143)
                </label>
              </div>
            </div>
            <div class="text-center">
              <button type="submit" class="btn btn-primary">Update Account</button>
              <a href="{{ url_for('list_accounts') }}" class="btn btn-secondary">Cancel</a>
            </div>
          </form><!-- End Multi Columns Form -->

        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
  // Auto-update port based on encryption selection
  document.querySelectorAll('input[name="encryption"]').forEach(function(radio) {
    radio.addEventListener('change', function() {
      const portField = document.getElementById('port');
      if (this.value === 'ssl') {
        portField.value = 993;
      } else if (this.value === 'tls' || this.value === 'none') {
        portField.value = 143;
      }
    });
  });
</script>
{% endblock %}
